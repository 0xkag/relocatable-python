# vim: et sw=4 ts=4:

[buildout]
develop = .

installed = .installed-build.cfg

#parts = libxml2 libxslt cyrus-sasl libevent libev zeromq openldap graphviz

parts =
##    zlib
##    bzip2
##    ncurses
##    readline
#    libiconv
#    gettext
    openssl
#    openssh
#    libgpg-error
#    libgcrypt
#    gnutls
###    gdb
##    sqlite3
##    db
##    gdbm
##    libffi
###    python

# do not use eggs from site-packages
include-site-packages = false

# bin/buildout will be generated with code that makes the paths relative
relative-paths = true

# unzip safe-zip eggs. Zipped eggs make debugging more difficult
unzip = true

# location of the download cache is specified by the download-cache option
download-cache = .cache

log-level = DEBUG

[options]
configure-options = --prefix=${options:prefix} --disable-rpath
environment-section = environment
hooks-dir = ${buildout:directory}/src/hooks
ignore-existing = true
keep-compile-dir = true
patch-options = -p1
patches-dir = ${buildout:directory}/src/patches
prefix = ${buildout:directory}/dist

[options-no-disable-rpath]
<= options
configure-options = --prefix=${options:prefix}

[environment]
CC = gcc -static-libgcc
CFLAGS = -I${options:prefix}/include
CPPFLAGS = ${:CFLAGS}
DYLD_LIBRARY_PATH = ${options:prefix}/lib
LD_LIBRARY_PATH = ${:DYLD_LIBRARY_PATH}
LDFLAGS = -L${options:prefix}/lib -Wl,-rpath=\$$ORIGIN/../lib
LIBPATH = -L${options:prefix}/lib

[archive]
ext = .tar.gz
name = ${:_buildout_section_name_}
recipe = hexagonit.recipe.cmmi

[urls]
gnu = https://ftp.gnu.org/gnu
gnupg = ftp://ftp.gnupg.org/gcrypt

[site-gnu]
<= archive
url = ${urls:gnu}/${:name}/${:name}-${:version}${:ext}

[site-gnupg]
<= archive
ext = .tar.bz2
url = ${urls:gnupg}/${:name}/${:name}-${:version}${:ext}

[bzip2]
<= archive
   options
version = 1.0.6
url = http://www.bzip.org/${:version}/${:name}-${:version}.tar.gz
patches = ${:patches-dir}/${:name}-${:version}-unix-Makefile.patch
configure-command = echo
make-options =
    PREFIX=${:prefix}
    DESTDIR=${:prefix}
make-targets =
    check
    install

[db]
<= archive
   options
version = 5.1.25
url = ftp://python.infinidat.com/archives/db-${:version}.tar.gz
configure-options =
    ${options:configure-options}
    --disable-java
    --enable-hash
configure-command = ./dist/configure

[gdb]
<= options-no-disable-rpath
   site-gnu
version = 7.6

[gdbm]
<= options
   site-gnu
version = 1.8.3
# TODO new version available
patches = ${:patches-dir}/${:name}-${:version}-Makefile.patch

[gettext]
<= options
   site-gnu
version = 0.18.1.1
configure-options =
    ${options:configure-options}
    --without-cvs
    --without-git
make-targets =
    check
    install

[gnutls]
<= options
   site-gnu
ext = .tar.bz2
version = 2.12.20
configure-options =
    ${options:configure-options}
    --with-libgcrypt
    --with-libgcrypt-prefix=${:prefix}
make-targets =
    check
    install

[libffi]
<= archive
   options
version = 3.0.13
url = ftp://sourceware.org/pub/libffi/libffi-${:version}.tar.gz

[libgcrypt]
<= options
   site-gnupg
version = 1.5.3
configure-options =
    ${options:configure-options}
    --with-gpg-error-prefix=${:prefix}
make-targets =
    check
    install

[libgpg-error]
<= options
   site-gnupg
version = 1.12

[libiconv]
<= options
   site-gnu
version = 1.13.1
configure-options =
    ${options:configure-options}
    --enable-relocatable
make-targets =
    check
    install

[ncurses]
<= options
   site-gnu
version = 5.9
configure-options =
    ${options:configure-options}
    --disable-big-core
    --disable-largefile
    --disable-macros
    --disable-root-environ
    --with-shared
    --without-ada
    --without-cxx-binding
#not sure why this was above? --with-gpg-error-prefix=${:prefix}

[openssh]
<= archive
   options
version = 6.2p2
url = ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-${:version}.tar.gz
environment-section = openssh-environment
configure-options =
    ${options:configure-options}
    --with-ssl-dir=${options:prefix}
    --without-openssl-header-check

[openssh-environment]
<= environment
CFLAGS = ${environment:CFLAGS} -I{$:prefix}/include/openssl

[openssl]
<= archive
   options-no-disable-rpath
version = 1.0.1e
#url = http://openssl.initrd.net/source/openssl-${:version}.tar.gz
url = https://www.openssl.org/source/openssl-${:version}.tar.gz
configure-command = ./config
configure-options =
    ${options-no-disable-rpath:configure-options}
    --libdir=lib
    shared
    zlib-dynamic
    -Wl,-rpath,\\\$\$\$\$\\\$\$\$\$ORIGIN/../lib
make-targets =
    test
    install

[python]
<= archive
   options-no-disable-rpath
version = 2.7.5
url = http://www.python.org/ftp/python/${:version}/Python-${:version}.tgz
environment-section = python-environment
configure-options =
    ${options-no-disable-rpath:configure-options}
    --enable-ipv6
    --enable-shared
    --with-dbmliborder=gdbm
    --with-gcc
patches =
    ${:patches-dir}/${:name}-${:version}-sysconfig.py.patch
    ${:patches-dir}/${:name}-${:version}-disutils-sysconfig.py.patch
    ${:patches-dir}/${:name}-${:version}-pythonhome-pythonrun.c.patch
post-make-hook = ${options:hooks-dir}/posix.py:purge_sysconfigdata

[python-environment]
<= environment
#CFLAGS = ${environment:CFLAGS} -I${options:prefix}/include/gnutls -I${options:prefix}/include/graphviz -I${options:prefix}/include/libexslt -I${options:prefix}/include/libxml2 -I${options:prefix}/include/libxslt -I${options:prefix}/include/ncurses -I${options:prefix}/include/openssl -I${options:prefix}/include/readline -I${options:prefix}/include/sasl
#LDFLAGS = ${environment:LDFLAGS} -L${options:prefix}/lib/engines -L${options:prefix}/lib/gettext -L${options:prefix}/lib/graphviz -L${options:prefix}/lib/libffi-3.0.9 -L${options:prefix}/lib/libxslt-plugins -L${options:prefix}/lib/pkgconfig -L${options:prefix}/lib/python2.7 -L${options:prefix}/lib/sasl2
PATH = ${options:prefix}/bin:%(PATH)s

[readline]
<= options-no-disable-rpath
   site-gnu
version = 6.2
environment-section = readline-environment
# needs this? (wasn't here before) configure-options = --with-curses

[readline-environment]
<= environment
LDFLAGS = ${environment:LDFLAGS} -lncurses

[sqlite3]
<= archive
   options
version = 3071700
url = https://www.sqlite.org/2013/sqlite-autoconf-${:version}.tar.gz

[zlib]
<= archive
   options-no-disable-rpath
version = 1.2.8
url = http://zlib.net/zlib-${:version}${:ext}
make-targets = 
    test
    install








[cyrus-sasl]
<= options
recipe = hexagonit.recipe.cmmi
name = cyrus-sasl
version = 2.1.23
url = ftp://python.infinidat.com/archives/${:name}-${:version}.tar.gz
configure-options = --prefix=${options:prefix} --without-saslauthd --without-authdaemond --disable-java --disable-dependency-tracking --disable-rpath --disable-java --without-gdbm --without-dblib --disable-macos-framework
patches = ${:patches-dir}/${:name}-${:version}-configure.patch
    ${:patches-dir}/${:name}-${:version}-ltconfig.patch
    ${:patches-dir}/${:name}-${:version}-digestmd5.patch

[openldap]
<= options
recipe = hexagonit.recipe.cmmi
url = ftp://python.infinidat.com/archives/openldap-stable-20100719.tgz
configure-options = --prefix=${options:prefix} --disable-slapd --disable-backends --disable-rpath

[libxml2]
<= options
recipe = hexagonit.recipe.cmmi
version = 2.7.8
url = ftp://python.infinidat.com/archives/libxml2-${:version}.tar.gz
configure-options = ${options:configure-options} --without-python

[libxslt]
<= options
recipe = hexagonit.recipe.cmmi
version = 1.1.26
url = ftp://python.infinidat.com/archives/libxslt-${:version}.tar.gz
configure-options = ${options:configure-options} --without-python --without-plugins --with-libxml-prefix=${:prefix}
environment-section = libxslt-environment

[libxslt-environment]
<= environment
CFLAGS = ${environment:CFLAGS} -I${options:prefix}/include/libxml2

[libevent]
<= options
recipe = hexagonit.recipe.cmmi
version = 1.4.13
url = ftp://python.infinidat.com/archives/libevent-${:version}-stable.tar.gz

[libev]
<= options
recipe = hexagonit.recipe.cmmi
version = 4.15
url = http://dist.schmorp.de/libev/libev-${:version}.tar.gz

[zeromq]
<= options
recipe = hexagonit.recipe.cmmi
version = 3.2.2
url = http://download.zeromq.org/zeromq-${:version}.tar.gz
configure-options = --prefix=${options:prefix} --disable-rpath --disable-dependency-tracking

[graphviz]
<= options
recipe = hexagonit.recipe.cmmi
version = 2.30.1
url = http://www.graphviz.org/pub/graphviz/stable/SOURCES/graphviz-${:version}.tar.gz
configure-options = --prefix=${options:prefix} --disable-rpath --disable-dependency-tracking
